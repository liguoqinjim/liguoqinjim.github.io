

  
    
  


  





  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.44 with theme Tranquilpeak 0.4.3-BETA">
    <title>系统学习Docker 践行DevOps理念 笔记(七)|容器编排Kubernetes</title>
    <meta name="author" content="Liguoqinjim">
    <meta name="keywords" content="docker">

    <link rel="icon" href="https://liguoqinjim.com/favicon.png">
    

    
    <meta name="description" content="容器编排Kubernetes，是课程第九章的内容

">
    <meta property="og:description" content="容器编排Kubernetes，是课程第九章的内容

">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="系统学习Docker 践行DevOps理念 笔记(七)|容器编排Kubernetes">
    <meta property="og:url" content="/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%83%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92kubernetes/">
    <meta property="og:site_name" content="Liguoqinjim&#39;s Blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Liguoqinjim&#39;s Blog">
    <meta name="twitter:description" content="容器编排Kubernetes，是课程第九章的内容

">
    
    

    
    

    
      <meta property="og:image" content="https://liguoqinjim.com/img/avatar.jpg">
    

    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://liguoqinjim.com/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    

    
      
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-113128130-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://liguoqinjim.com/">Liguoqinjim&#39;s Blog</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://liguoqinjim.com/#about">
    
    
    
      
        <img class="header-picture" src="https://liguoqinjim.com/img/avatar.jpg" alt="作者的图片" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://liguoqinjim.com/#about">
          <img class="sidebar-profile-picture" src="https://liguoqinjim.com/img/avatar.jpg" alt="作者的图片" />
        </a>
        <h4 class="sidebar-profile-name">Liguoqinjim</h4>
        
          <h5 class="sidebar-profile-bio">Keep simple</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://liguoqinjim.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">首页</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://liguoqinjim.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">分类</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://liguoqinjim.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">标签</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://liguoqinjim.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">归档</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://liguoqinjim.com/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">关于</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/liguoqinjim" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://liguoqinjim.com/">
    
      
      
      <span class="sidebar-button-desc"></span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://liguoqinjim.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      系统学习Docker 践行DevOps理念 笔记(七)|容器编排Kubernetes
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-08-30T15:28:22&#43;08:00">
        
  八月 30, 2018

      </time>
    
    
  
  
    <span>发布在</span>
    
      <a class="category-link" href="https://liguoqinjim.com/categories/docker">docker</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>容器编排Kubernetes，是课程第九章的内容</p>

<p></p>

<h1 id="table-of-contents">目录</h1><nav id="TableOfContents">
<ul>
<li><a href="#1-kubenetes简介">1.Kubenetes简介</a>
<ul>
<li><a href="#1-1为什么简写是k8s">1.1为什么简写是k8s</a></li>
</ul></li>
<li><a href="#2-minikube快速搭建k8s单节点环境">2.Minikube快速搭建K8S单节点环境</a>
<ul>
<li><a href="#2-1配置k8s环境">2.1配置K8S环境</a></li>
<li><a href="#2-2安装kubetcl">2.2安装kubetcl</a></li>
<li><a href="#2-3minikube">2.3minikube</a></li>
<li><a href="#2-4kubectl">2.4kubectl</a></li>
</ul></li>
<li><a href="#3-k8s最小调度单位pod">3.K8S最小调度单位Pod</a>
<ul>
<li><a href="#notice">NOTICE</a></li>
</ul></li>
<li><a href="#4-replicaset和replicationcontroller">4.ReplicaSet和ReplicationController</a>
<ul>
<li><a href="#notice-1">NOTICE</a></li>
</ul></li>
<li><a href="#5-deployment">5.Deployment</a>
<ul>
<li><a href="#notice-2">NOTICE</a></li>
</ul></li>
<li><a href="#6-使用tectonic在本地搭建多节点k8s集群">6.使用Tectonic在本地搭建多节点K8S集群</a>
<ul>
<li><a href="#notice-3">NOTICE</a></li>
</ul></li>
<li><a href="#7-k8s基础网络cluster-network">7.k8s基础网络Cluster Network</a></li>
<li><a href="#8-service简介和演示">8.Service简介和演示</a>
<ul>
<li><a href="#8-1不要直接使用和管理pods">8.1不要直接使用和管理Pods</a></li>
<li><a href="#8-2service">8.2Service</a></li>
</ul></li>
<li><a href="#9-nodeport类型service以及label的简单实用">9.NodePort类型Service以及Label的简单实用</a>
<ul>
<li><a href="#9-1nodeport类型service">9.1NodePort类型Service</a></li>
<li><a href="#9-2label">9.2Label</a></li>
<li><a href="#notice-4">NOTICE</a></li>
</ul></li>
<li><a href="#10-准备工作-使用kops在亚马逊aws上搭建k8s集群">10.准备工作——使用kops在亚马逊AWS上搭建k8s集群</a></li>
<li><a href="#11-使用kops在亚马逊aws上搭建k8s集群">11.使用kops在亚马逊AWS上搭建k8s集群</a></li>
<li><a href="#12-loadblancer类型service以及aws的dns服务配置">12.LoadBlancer类型Service以及AWS的DNS服务配置</a></li>
<li><a href="#13-在亚马逊k8s集群上部署wordpress">13.在亚马逊k8s集群上部署wordpress</a></li>
</ul>
</nav>

<h1 id="1-kubenetes简介">1.Kubenetes简介</h1>

<p><img src="https://liguoqinjim.com/img/docker/note7/k8s.png" alt="k8s" /></p>

<h2 id="1-1为什么简写是k8s">1.1为什么简写是k8s</h2>

<p>因为kubernetes，k和s之间一共有8个字母</p>

<h1 id="2-minikube快速搭建k8s单节点环境">2.Minikube快速搭建K8S单节点环境</h1>

<h2 id="2-1配置k8s环境">2.1配置K8S环境</h2>

<ol>
<li><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way">https://github.com/kelseyhightower/kubernetes-the-hard-way</a>
这个是k8s的从头开始安装的方法</li>
<li><a href="https://github.com/kubernetes/minikube">https://github.com/kubernetes/minikube</a>
这个是在本地跑一个最简单的k8s，只有一个节点。类似vagrant，是要借助virtual box这种的</li>
</ol>

<h2 id="2-2安装kubetcl">2.2安装kubetcl</h2>

<p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></p>

<h2 id="2-3minikube">2.3minikube</h2>

<p>minikube相关命令：</p>

<ol>
<li>minikube start，启动minikube节点</li>
<li>minikube ssh，连接到minikube内部</li>
<li>minikube stop</li>
</ol>

<h2 id="2-4kubectl">2.4kubectl</h2>

<p>kubectl context:<br />
里面存着一个kubernetes集群的信息，比如集群的host。kubectl下可能有多个context，我们可以通过context去管理多个k8s集群</p>

<p>相关命令：</p>

<ol>
<li>kubectl config view</li>
<li>kubectl config get-contexts，得到现在是用的哪个context</li>
<li>kubectl cluster-info，得到集群信息</li>
<li>kubectl version</li>
</ol>

<h1 id="3-k8s最小调度单位pod">3.K8S最小调度单位Pod</h1>

<p>k8s不对容器进行操作，因为最小单位是pod。同一个pod里面的容器，是在一个namespace下的，这里的namespace包括所有的namespace(如network namespace)</p>

<p>相关命令：</p>

<ul>
<li>kubectl create -f pod_nginx.yml，创建pod</li>
<li>kubectl delete -f pod_nginx.yml，删除pod</li>
<li>kubectl get pods，查看pods的情况</li>
<li>kubectl get pods -o wide，加了wide参数之后，会显示更多信息</li>
<li>上面的命令，可以看到pod里面的容器具体是在哪个机器上的，要进入这个容器，我们先ssh到这个机器上，然后docker exec -it container_name sh，</li>
<li>kubectl describe pods nginx，查看pods的具体信息</li>
<li>kubectl port-forward nginx 8080:80，映射本地的8080端口和pod的80端口，nginx是pod name，但是要注意的是，这个命令一旦ctrl+c退出，映射就结束了。8080端口是运行了kubectl的机器的端口，不是pod所在的容器的端口。</li>
</ul>

<p>pod_nginx.yml：</p>

<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  containers:
  - name: nginx
    image: nginx #使用的镜像
    ports:
    - containerPort: 80
</code></pre>

<h2 id="notice">NOTICE</h2>

<p>kubectl create之后，可能pod会一直不启动，这个时候可以通过minikube logs查看错误日志。我遇到的问题的是不能拉取镜像，是要翻墙的网址。
解决这个问题可以在启动minikube的时候，指定代理：</p>

<pre><code>minikube start --docker-env=HTTP_PROXY=http://$YOURPROXY:PORT \
                 --docker-env=HTTPS_PROXY=https://$YOURPROXY:PORT
</code></pre>

<p>参考资料：<a href="https://github.com/kubernetes/minikube/blob/master/docs/http_proxy.md">https://github.com/kubernetes/minikube/blob/master/docs/http_proxy.md</a></p>

<h1 id="4-replicaset和replicationcontroller">4.ReplicaSet和ReplicationController</h1>

<p>ReplicaSet是新一代的ReplicationController。这里的replica就是我们之前docker里面遇到的是一样的。也是多个，这里就是多个pod。下面简称rc或者rs</p>

<p>相关命令：</p>

<ul>
<li>kubectl create -f rc_nginx.yml，创建replicationController，rc_nginx.yml见docker_labs</li>
<li>kubectl get rc，可以查看rc的情况</li>
<li>kubectl get pods，查看pod的情况</li>
<li>kubectl delete pods nginx-6cznp，删除这个一个pod</li>
<li>kubectl scale rc nginx &ndash;replicas=2，修改rc的pod数量</li>
<li>kubectl delete rc nginx，删除replicationController
-kubectl create -f rs_nginx.yml，创建replicaSet，ns_nginx.yml见docker-labs</li>
<li>kubectl get rs，查看rs的情况</li>
<li>kubectl scale rs nginx &ndash;replicas=2，对rs进行scale</li>
</ul>

<p>rc_nginx.yml：</p>

<pre><code>apiVersion: v1
kind: ReplicationController
metadata:
  name: nginx
spec:
  replicas: 3
  selector:
    app: nginx
  template:
    metadata:
      name: nginx
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx #使用nginx镜像
        ports:
        - containerPort: 80
</code></pre>

<p>rs_nginx.yml:</p>

<pre><code>apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: nginx
  labels:
    tier: frontend
spec:
  replicas: 3
  selector:
    matchLabels:
      tier: frontend
  template:
    metadata:
      name: nginx
      labels:
        tier: frontend
    spec:
      containers:
      - name: nginx
        image: nginx #使用nginx镜像
        ports:
        - containerPort: 80
</code></pre>

<h2 id="notice-1">NOTICE</h2>

<p>要是我们在rc或者rs下创建pod，然后我们去强制删除这个pod，删除之后，rc和rs会自动再去创建一个pod。rc和rs会保持pod的数量，所以就算只创建一个pod，也推荐使用rc或者rs。因为这会保持pod的数量。</p>

<h1 id="5-deployment">5.Deployment</h1>

<p>Deployment描述了一种希望的状态，是对pods和replicaset的希望达到的一个状态。比如我希望这个replicaset是有3个replica的，pods的image是nginx。之后我们要修改的话，只要把希望的状态改变，deployment就会自动帮我们完成。
需要注意的是，我们通过deployment创建的replicaset和pod，创建了之后，我们就不能独立的对replicaset和pod进行删除了，我们一定要对deployment进行操作</p>

<p>相关命令：</p>

<ol>
<li>kubectl create -f deployment_nginx.yml，创建deployment，详见docker-lab</li>
<li>kubectl get deployment，得到deployment的情况</li>
<li>kubectl get deployment -o wide，得到详细情况</li>
<li>kubectl set image deployment nginx-deployment nginx=nginx:1.13，更新镜像，nginx-deployment是deployment的name，nginx:1.13是新的镜像</li>
<li>kubectl rollout history deployment nginx-deployment，查看deployment的历史版本</li>
<li>kubectl rollout undo deployment nginx-deployment，撤销之前的操作，比如我们先更新了一个镜像，然后我们使用undo，就会变回原来的镜像了</li>
<li>kubectl get node -o wide，查看k8s node的情况</li>
<li>kubectl expose deployment nginx-deployment &ndash;type=NodePort，会暴露到node的一个随机端口上，是暴露到最终运行pod的机器上，不是运行kubectl的机器上，具体可以看9-8</li>
<li>kubectl get services，查看services的情况，因为我们用了8的命令，所以service会随机一个端口绑定到容器的80端口。是绑定到最终运行pod的node上的，不是运行kubectl的机器</li>
<li>kubectl delete service nginx-deployment，删除service</li>
</ol>

<p>deployment_nginx.yml：</p>

<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.12.2 #先指定这个版本的nginx,之后可以更新
        ports:
        - containerPort: 80
</code></pre>

<h2 id="notice-2">NOTICE</h2>

<p>deployment下的replicaset和pods的name，replicaset的前缀是deployment的name，pods的name的前缀是replicaset的name</p>

<h1 id="6-使用tectonic在本地搭建多节点k8s集群">6.使用Tectonic在本地搭建多节点K8S集群</h1>

<p>tectonic的脚本详见docker-lab，要注意的是，vagrant up的时候用的脚本，访问的基本都是被墙的网址，在脚本里面设置代理很麻烦，我最后是直接在路由器上安装了代理，才安装好。</p>

<p>相关命令：</p>

<ol>
<li>kubectl config get-contexts，查看kubectl的context</li>
<li>kubectl config use-context tectonic，切换到tectonic这个context</li>
</ol>

<h2 id="notice-3">NOTICE</h2>

<p>我一开始用kubectl_1.11的版本使用命令kubectl get nodes的时候，会返回错误，然后我就用了kubectl的1.8这个版本，就正确了。</p>

<p>参考资料：<a href="https://github.com/kubernetes/kubernetes/issues/65575">https://github.com/kubernetes/kubernetes/issues/65575</a></p>

<h1 id="7-k8s基础网络cluster-network">7.k8s基础网络Cluster Network</h1>

<p><img src="https://liguoqinjim.com/img/docker/note7/k8s_network.png" alt="k8s_network" /></p>

<p>这个flannel其实是一个k8s的网络插件，也可以不用flannel，可以用的别的网络插件。
k8s的网络插件，要符合最基本的3个规则，详见：<br />
<a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/">https://kubernetes.io/docs/concepts/cluster-administration/networking/</a></p>

<h1 id="8-service简介和演示">8.Service简介和演示</h1>

<h2 id="8-1不要直接使用和管理pods">8.1不要直接使用和管理Pods</h2>

<p><img src="https://liguoqinjim.com/img/docker/note7/pods.png" alt="pods" /></p>

<p>这里创建新的pods倒是没问题，但是最关键的是，新创建的pod可能ip会变。我们现在打个比方，我有两个pod，一个是nginx，还有一个是db，现在我db的pod被terminated然后创建了一个新的。这个时候要是db的ip变了，nginx是没办法修改的。所以我们需要用到service来解决这个问题，service就会给一个不变的ip和pod的ip相当于映射住，service的ip是不变的。那我们访问service的ip就可以了。然后我们要是用deployment这种，replica设成多个，我们可以在deployment上创建service，那么这个service会自动帮我们在多个replica之间做负载均衡。</p>

<h2 id="8-2service">8.2Service</h2>

<p><img src="https://liguoqinjim.com/img/docker/note7/services.png" alt="services" /></p>

<p>本节课说的是ClusterIP的，这种service是在cluster内部，任何一台机器都可以访问的，但是也仅限于cluster内部</p>

<p>相关命令：</p>

<ol>
<li>kubectl expose pods nginx-pod，创建service，默认是ClusterIP</li>
<li>kubectl get svc/services，svc是简写</li>
<li>kubectl expose deployment service-test，在deployment上创建一个service，会为deployment里面的pods自动做负载均衡</li>
<li>kubectl edit deployment service-test，这样可以更新service-test这个deployment的配置，然后k8s会帮我们自己更新</li>
</ol>

<h1 id="9-nodeport类型service以及label的简单实用">9.NodePort类型Service以及Label的简单实用</h1>

<h2 id="9-1nodeport类型service">9.1NodePort类型Service</h2>

<p>创建NodePort的service，有两种方式，一种用命令创建，一种是用yml文件来创建。
NodePort是可以给外网访问的，而且是集群内，所有node的ip加上这个service的port都可以访问。NodePort的端口是有范围的，是从30000-32767</p>

<p>用命令创建：</p>

<ol>
<li>kubectl create -f pod_nginx.yml，创建pod_nginx，yml见docker-lab</li>
<li>kubectl expose pods nginx-pod &ndash;type=NodePort，创建NodePort的service</li>
<li>kubectl get svc，查看创建的sevice，注意，在service我们会看到NodePort类型的service，会随机一个端口映射到pod的端口。这个时候所有node的ip+这个端口，就可以访问pod</li>
</ol>

<p>用文件创建：</p>

<p>pod_nginx.yml:</p>

<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
  labels:
    app: nginx
spec:
  containers:
  - name: nginx-container
    image: nginx
    ports:
    - name: nginx-port #这个name，service_nginx.yml里面会使用到
      containerPort: 80
</code></pre>

<p>service_nginx.yml</p>

<pre><code>apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  ports:
  - port: 32333
    nodePort: 32333
    targetPort: nginx-port #pod_nginx.yml里面的ports下的name
    protocol: TCP
  selector:
    app: nginx # label
  type: NodePort
</code></pre>

<ol>
<li>targetPort后面要跟pod的yml文件里面的ports下的name</li>
<li>selector后面的值是label的key和value，通过这个值去选择有这个label的pod去创建这个service</li>
</ol>

<h2 id="9-2label">9.2Label</h2>

<p>k8s里面，几乎所有的resource，如pod，deployment等等，我们都可以设置标签。比如我们可以指定nodeSelector，那么我们在创建pod的时候，就可以指定我们这个pod是要创建在哪个node上。</p>

<p>相关命令：</p>

<ol>
<li>kubectl label node w1.tectonicsandbox.com hardware=good，这个就是给w1这个node添加了一个label</li>
<li>kubectl get node &ndash;show-labels，可以查看label</li>
</ol>

<h2 id="notice-4">NOTICE</h2>

<ol>
<li>在生产环境里面，ClusterIP因为只能在cluster内部访问，外部是不能访问的，所以不会用。NodePort的端口又是有限的，所以一般也不会使用，但是是可以使用的。</li>
<li>NodePort的端口是有范围的，是从30000-32767</li>
</ol>

<h1 id="10-准备工作-使用kops在亚马逊aws上搭建k8s集群">10.准备工作——使用kops在亚马逊AWS上搭建k8s集群</h1>

<p>kops: <a href="https://github.com/kubernetes/kops">https://github.com/kubernetes/kops</a></p>

<h1 id="11-使用kops在亚马逊aws上搭建k8s集群">11.使用kops在亚马逊AWS上搭建k8s集群</h1>

<p>使用kops，在AWS创建k8s集群</p>

<h1 id="12-loadblancer类型service以及aws的dns服务配置">12.LoadBlancer类型Service以及AWS的DNS服务配置</h1>

<p>service里面还有一个类型是，loadblancer，这个类型是需要云服务商的支持的，本地是没法测试的。这个service会给出一个url，然后加上给出的端口就可以访问了。因为这个url会很长，所以我们还可以使用dns来添加ANAME来映射到一个短的sub domain</p>

<h1 id="13-在亚马逊k8s集群上部署wordpress">13.在亚马逊k8s集群上部署wordpress</h1>

<p>略</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">标签</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://liguoqinjim.com/tags/docker/">docker</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AB%E5%AE%B9%E5%99%A8%E7%9A%84%E7%9A%84%E8%BF%90%E7%BB%B4%E5%92%8C%E7%9B%91%E6%8E%A7/" data-tooltip="系统学习Docker 践行DevOps理念 笔记(八)|容器的的运维和监控">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AD%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92docker-swarm/" data-tooltip="系统学习Docker 践行DevOps理念 笔记(六)|容器编排Docker Swarm">
              
                  <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Liguoqinjim. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AB%E5%AE%B9%E5%99%A8%E7%9A%84%E7%9A%84%E8%BF%90%E7%BB%B4%E5%92%8C%E7%9B%91%E6%8E%A7/" data-tooltip="系统学习Docker 践行DevOps理念 笔记(八)|容器的的运维和监控">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AD%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92docker-swarm/" data-tooltip="系统学习Docker 践行DevOps理念 笔记(六)|容器编排Docker Swarm">
              
                  <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://liguoqinjim.com/img/avatar.jpg" alt="作者的图片" />
    
    <h4 id="about-card-name">Liguoqinjim</h4>
    
      <div id="about-card-bio">Keep simple</div>
    
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Shanghai
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="搜索" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center"></div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AB%E5%AE%B9%E5%99%A8%E7%9A%84%E7%9A%84%E8%BF%90%E7%BB%B4%E5%92%8C%E7%9B%91%E6%8E%A7/">
                <h3 class="media-heading">系统学习Docker 践行DevOps理念 笔记(八)|容器的的运维和监控</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>容器的的运维和监控，是课程第十章的内容</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%83%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92kubernetes/">
                <h3 class="media-heading">系统学习Docker 践行DevOps理念 笔记(七)|容器编排Kubernetes</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>容器编排Kubernetes，是课程第九章的内容</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AD%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92docker-swarm/">
                <h3 class="media-heading">系统学习Docker 践行DevOps理念 笔记(六)|容器编排Docker Swarm</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>容器编排Docker Swarm，是课程第七章的内容</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%BA%94docker-compose%E5%A4%9A%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2/">
                <h3 class="media-heading">系统学习Docker 践行DevOps理念 笔记(五)|Docker Compose多容器部署</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Docker Compose多容器部署，是课程第六章的内容</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%9B%9Bdocker%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E5%92%8C%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB/">
                <h3 class="media-heading">系统学习Docker 践行DevOps理念 笔记(四)|Docker的持久化存储和数据共享</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Docker的持久化存储和数据共享，是课程第五章的内容</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%89docker%E7%9A%84%E7%BD%91%E7%BB%9C/">
                <h3 class="media-heading">系统学习Docker 践行DevOps理念 笔记(三)|Docker的网络</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Docker的网络，是课程第四章的内容</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%BA%8Cdocker%E7%9A%84%E9%95%9C%E5%83%8F%E5%92%8C%E5%AE%B9%E5%99%A8/">
                <h3 class="media-heading">系统学习Docker 践行DevOps理念 笔记(二)|Docker的镜像和容器</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Docker的镜像和容器，是课程第三章的内容</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/08/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%80docker%E7%9A%84%E5%AE%89%E8%A3%85/">
                <h3 class="media-heading">系统学习Docker 践行DevOps理念 笔记(一)|Docker的安装</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Docker的安装</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/07/leetcode-0008-string-to-integer-atoi/">
                <h3 class="media-heading">LeetCode-0008-String to Integer (atoi)</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://liguoqinjim.com/2018/07/leetcode-0020-valid-parentheses/">
                <h3 class="media-heading">LeetCode-0020-Valid Parentheses</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero=""
         data-message-one=""
         data-message-other="">
         18 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://liguoqinjim.com/images/cover.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://liguoqinjim.com/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/liguoqinjim.com\/2018\/08\/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%83%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92kubernetes\/';
          
            this.page.identifier = '\/2018\/08\/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%83%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92kubernetes\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'liguoqinjim';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

