<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>系统学习Docker 践行DevOps理念 笔记(八)|容器的的运维和监控 - LI的技术笔记</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">


  <meta name="description" content="容器的的运维和监控，是课程第十章的内容
" />
<meta name="keywords" content="docker" />







<meta name="generator" content="Hugo 0.58.3" />


<link rel="canonical" href="https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AB/" />





<link rel="icon" href="https://liguoqinjim.cn/favicon.ico" />











<link rel="stylesheet" href="https://liguoqinjim.cn/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="系统学习Docker 践行DevOps理念 笔记(八)|容器的的运维和监控" />
<meta property="og:description" content="容器的的运维和监控，是课程第十章的内容" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AB/" />
<meta property="article:published_time" content="2018-08-30T22:18:05+08:00" />
<meta property="article:modified_time" content="2018-08-30T22:18:05+08:00" />
<meta itemprop="name" content="系统学习Docker 践行DevOps理念 笔记(八)|容器的的运维和监控">
<meta itemprop="description" content="容器的的运维和监控，是课程第十章的内容">


<meta itemprop="datePublished" content="2018-08-30T22:18:05&#43;08:00" />
<meta itemprop="dateModified" content="2018-08-30T22:18:05&#43;08:00" />
<meta itemprop="wordCount" content="87">



<meta itemprop="keywords" content="docker," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="系统学习Docker 践行DevOps理念 笔记(八)|容器的的运维和监控"/>
<meta name="twitter:description" content="容器的的运维和监控，是课程第十章的内容"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-113128130-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://liguoqinjim.cn/" class="logo">LI的技术笔记</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liguoqinjim.cn/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/liguoqinjim" rel="noopener" target="_blank">
              Works
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liguoqinjim.cn/tags/">Tags</a>
          
        
      </li>
    

    
  </ul>
</nav>


  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="https://liguoqinjim.cn/" class="logo">
    
      LI的技术笔记
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liguoqinjim.cn/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/liguoqinjim" rel="noopener" target="_blank">
              Works
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liguoqinjim.cn/tags/">Tags</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">系统学习Docker 践行DevOps理念 笔记(八)|容器的的运维和监控</h1>
      
      <div class="post-meta">
        <time datetime="2018-08-30" class="post-time">
          2018-08-30
        </time>
        <div class="post-category">
            <a href="https://liguoqinjim.cn/categories/docker/"> docker </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title"></h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#1-容器的基本监控">1.容器的基本监控</a>
<ul>
<li><a href="#1-1weavework工具">1.1weavework工具</a></li>
</ul></li>
<li><a href="#2-k8s集群运行资源监控-heapster-grafana-influxdb">2.k8s集群运行资源监控——Heapster+Grafana+InfluxDB</a></li>
<li><a href="#3-根据资源占用自动横向伸缩">3.根据资源占用自动横向伸缩</a>
<ul>
<li><a href="#notice">NOTICE</a></li>
</ul></li>
<li><a href="#4-k8s集群log的采集和展示-elk-fluentd">4.k8s集群Log的采集和展示——ELK+Fluentd</a>
<ul>
<li><a href="#notice-1">NOTICE</a></li>
</ul></li>
<li><a href="#5-k8s集群监控方案prometheus">5.k8s集群监控方案Prometheus</a></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>容器的的运维和监控，是课程第十章的内容</p>

<!--toc-->

<h1 id="1-容器的基本监控">1.容器的基本监控</h1>

<p>相关命令：</p>

<ol>
<li>docker top d1ea6fa01bbd，top后面跟上容器名称可以查看docker的情况</li>
<li>docker stats，查看容器的使用情况</li>
</ol>

<h2 id="1-1weavework工具">1.1weavework工具</h2>

<ol>
<li>安装，<a href="https://github.com/weaveworks/scope">https://github.com/weaveworks/scope</a></li>
<li>scope launch 192.168.210.10，192.168.210.10是那个机器的外部可以访问的地址，然后就可以在网页里面查看docker的运行情况了</li>
<li>scope stop，可以关闭scope</li>
<li>scope lannch后面可以跟多个ip，只要能连通就可以了</li>
</ol>

<h1 id="2-k8s集群运行资源监控-heapster-grafana-influxdb">2.k8s集群运行资源监控——Heapster+Grafana+InfluxDB</h1>

<p>heapster: <a href="https://github.com/kubernetes/heapster">https://github.com/kubernetes/heapster</a><br />
详见lab010/lab002的三个yml文件，然后启动三个文件就可以了。</p>

<p>相关命令：</p>

<ol>
<li>kubectl get namespace，查看现在的namespace，默认我们创建的是创建在default的namespace下的</li>
<li>kubectl get svc &ndash;namespace kube-system，这个是得到kube-system这个namespace下的service</li>
<li>可以看到有一个kubernetes-dashboard的service，是NodePort的，我们可以进去看一下，是一个k8s的dashboard</li>
<li>grafana的默认密码是admin,admin</li>
<li>把grafana这个yml文件里面的service的type换成NodePort，我们就可以在外部访问了</li>
</ol>

<h1 id="3-根据资源占用自动横向伸缩">3.根据资源占用自动横向伸缩</h1>

<p>我们可以通过监控系统资源，比如cpu的使用率，来自动横向伸缩。比如cpu超过50%的使用率的时候，我们就自动新加一个机器。要是使用率低的，我们可以再减少一点机器。</p>

<p>相关命令：</p>

<ol>
<li>删除10-2里面的3个yml文件创建的资源</li>
<li>minikube addons list，查看minikube的addons，会看到enable还是disable</li>
<li>minikube addons enable heapster，enable heapster这个addons</li>
<li>minikube stop</li>
<li>minikube start &ndash;extra-config=controller-manager.HorizontalPodAutoscalerUseRESTClients=false，这个minikube的启动参数可以让创建autoscale的时候，可以获得cpu试用率</li>
<li>kubectl run php-apache &ndash;image=k8s.gcr.io/hpa-example &ndash;requests=cpu=200m &ndash;expose &ndash;port=80，按照k8s给出的教程，启动一个测试pod，&ndash;requests=cpu=200m这个参数限定了cpu的使用量</li>
<li>kubectl autoscale deployment php-apache &ndash;cpu-percent=50 &ndash;min=1 &ndash;max=10，创建一个autoscale，&ndash;cpu-percent表示cpu百分比多少的时候要添加pod，最少要一个pod，最多是10个pod</li>
<li>kubectl get horizontalpodautoscaler，得到现在集群里面的autoscaler，还有target的负载情况</li>
</ol>

<h2 id="notice">NOTICE</h2>

<ol>
<li>autoscale得到负载情况是需要时间的，通常会有一点延迟，不会是很实时的。</li>
<li>得到负载情况到完成自动伸缩，也是需要一点时间的</li>
</ol>

<h1 id="4-k8s集群log的采集和展示-elk-fluentd">4.k8s集群Log的采集和展示——ELK+Fluentd</h1>

<p><img src="https://liguoqinjim.cn/images/docker/note8/elk.png" alt="elk" /></p>

<p>这里没有logstash，而是用fluentd。LogTrail算是kibana里面的一个插件，看日志比较方便</p>

<h2 id="notice-1">NOTICE</h2>

<ol>
<li>所以要打日志的节点都要写加一个label，使用命令
kubectl label node &ndash;all beta.kubernetes.io/fluentd-ds-ready=true</li>
<li>kubecte create -f，后面可以跟文件夹，那么文件夹里面所有配置文件都会被创建3</li>
<li>具体的配置文件可以看视频里面，然后去docker-lab里面找</li>
</ol>

<h1 id="5-k8s集群监控方案prometheus">5.k8s集群监控方案Prometheus</h1>

<p><a href="https://prometheus.io/">https://prometheus.io/</a><br />
prometheus和别的监控方案有一个不一样的地方，就是他是采取拉的方式。elk或者其他的这种都是推的方式，也就是应用把日志主动的推向elk。但是prometheus是主动去拉数据，这是一个不一样的地方。<br />
具体配置文件见docker-labs</p>
    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://liguoqinjim.cn/tags/docker/">docker</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="https://liguoqinjim.cn/post/tool/vagrant%E5%85%A5%E9%97%A8/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Vagrant入门</span>
            <span class="prev-text nav-mobile"></span>
          </a>
        
          <a class="next" href="https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%83/">
            <span class="next-text nav-default">系统学习Docker 践行DevOps理念 笔记(七)|容器编排Kubernetes</span>
            <span class="prev-text nav-mobile"></span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E5%85%AB/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'liguoqinjim';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  


<a href="https://liguoqinjim.cn/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
       -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        © This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License，please give source if you wish to quote or reproduce.
        
      </span></span>

  
  

  
    <span>
      <a href='http://www.beian.miit.gov.cn'>沪ICP备19042199号-1</a>
    </span>
  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="https://liguoqinjim.cn/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="https://liguoqinjim.cn/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="https://liguoqinjim.cn/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>


























</body>
</html>
