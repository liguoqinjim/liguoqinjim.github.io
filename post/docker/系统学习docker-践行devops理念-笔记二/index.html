<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>系统学习Docker 践行DevOps理念 笔记(二)|Docker的镜像和容器 - LI的技术笔记</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">


  <meta name="description" content="Docker的镜像和容器，是课程第三章的内容
" />
<meta name="keywords" content="docker" />







<meta name="generator" content="Hugo 0.58.3" />


<link rel="canonical" href="https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%BA%8C/" />





<link rel="icon" href="https://liguoqinjim.cn/favicon.ico" />











<link rel="stylesheet" href="https://liguoqinjim.cn/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="系统学习Docker 践行DevOps理念 笔记(二)|Docker的镜像和容器" />
<meta property="og:description" content="Docker的镜像和容器，是课程第三章的内容" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%BA%8C/" />
<meta property="article:published_time" content="2018-08-28T13:36:04+08:00" />
<meta property="article:modified_time" content="2018-08-28T13:36:04+08:00" />
<meta itemprop="name" content="系统学习Docker 践行DevOps理念 笔记(二)|Docker的镜像和容器">
<meta itemprop="description" content="Docker的镜像和容器，是课程第三章的内容">


<meta itemprop="datePublished" content="2018-08-28T13:36:04&#43;08:00" />
<meta itemprop="dateModified" content="2018-08-28T13:36:04&#43;08:00" />
<meta itemprop="wordCount" content="490">



<meta itemprop="keywords" content="docker," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="系统学习Docker 践行DevOps理念 笔记(二)|Docker的镜像和容器"/>
<meta name="twitter:description" content="Docker的镜像和容器，是课程第三章的内容"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-113128130-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://liguoqinjim.cn/" class="logo">LI的技术笔记</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liguoqinjim.cn/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/liguoqinjim" rel="noopener" target="_blank">
              Works
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liguoqinjim.cn/tags/">Tags</a>
          
        
      </li>
    

    
  </ul>
</nav>


  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="https://liguoqinjim.cn/" class="logo">
    
      LI的技术笔记
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liguoqinjim.cn/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/liguoqinjim" rel="noopener" target="_blank">
              Works
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liguoqinjim.cn/tags/">Tags</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">系统学习Docker 践行DevOps理念 笔记(二)|Docker的镜像和容器</h1>
      
      <div class="post-meta">
        <time datetime="2018-08-28" class="post-time">
          2018-08-28
        </time>
        <div class="post-category">
            <a href="https://liguoqinjim.cn/categories/docker/"> docker </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title"></h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#1-docker架构和底层技术简介">1.Docker架构和底层技术简介</a></li>
<li><a href="#2-docker-image概述">2.Docker Image概述</a></li>
<li><a href="#3-diy一个base-image">3.DIY一个Base Image</a>
<ul>
<li><a href="#3-1优化输入docker命令的时候不用加sudo">3.1优化输入docker命令的时候不用加sudo</a></li>
</ul></li>
<li><a href="#3-2通过dockerfile简单构建镜像">3.2通过Dockerfile简单构建镜像</a></li>
<li><a href="#4-初识container">4.初识Container</a>
<ul>
<li><a href="#4-1容器相关命令">4.1容器相关命令：</a></li>
<li><a href="#4-2docker镜像拉取加速">4.2docker镜像拉取加速：</a></li>
</ul></li>
<li><a href="#5-构建自己的docker镜像">5.构建自己的Docker镜像</a>
<ul>
<li><a href="#5-1docker-commit的方式创建镜像">5.1docker commit的方式创建镜像</a></li>
<li><a href="#5-2使用dockerfile创建镜像">5.2使用Dockerfile创建镜像</a></li>
<li><a href="#notice">NOTICE</a></li>
</ul></li>
<li><a href="#6-dockerfile语法梳理及最佳实践">6.Dockerfile语法梳理及最佳实践</a>
<ul>
<li><a href="#6-1from">6.1FROM</a></li>
<li><a href="#6-2label">6.2LABEL</a></li>
<li><a href="#6-3run">6.3RUN</a></li>
<li><a href="#6-4workdir">6.4WORKDIR</a></li>
<li><a href="#6-5add-and-copy">6.5ADD and COPY</a></li>
<li><a href="#6-6env">6.6ENV</a></li>
<li><a href="#notice-1">NOTICE</a></li>
</ul></li>
<li><a href="#7-run-vs-cmd-vs-entrypoint">7.RUN vs CMD vs ENTRYPOINT</a>
<ul>
<li><a href="#7-1shell和exec格式的区别">7.1Shell和Exec格式的区别</a>
<ul>
<li><a href="#shell格式">Shell格式</a></li>
<li><a href="#notice-2">NOTICE</a></li>
</ul></li>
<li><a href="#7-2cmd和entrypoint的区别">7.2CMD和ENTRYPOINT的区别</a>
<ul>
<li><a href="#cmd">CMD</a></li>
<li><a href="#entrypoint">ENTRYPOINT</a></li>
<li><a href="#notice-3">NOTICE</a></li>
</ul></li>
</ul></li>
<li><a href="#8-镜像的发布">8.镜像的发布</a>
<ul>
<li><a href="#8-1docker-push">8.1docker push</a></li>
<li><a href="#8-2docker-hub和github相连接">8.2docker hub和github相连接</a></li>
<li><a href="#8-3自建docker-registry">8.3自建docker registry</a></li>
</ul></li>
<li><a href="#9-dockerfile实战">9.Dockerfile实战</a>
<ul>
<li><a href="#notice-4">NOTICE</a></li>
</ul></li>
<li><a href="#10-容器的操作">10.容器的操作</a></li>
<li><a href="#11-dockerfile实战-2">11.Dockerfile实战(2)</a></li>
<li><a href="#12-容器的资源限制">12.容器的资源限制</a>
<ul>
<li><a href="#12-1限制内存">12.1限制内存</a></li>
<li><a href="#12-2限制cpu">12.2限制cpu</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>Docker的镜像和容器，是课程第三章的内容</p>

<!-- toc -->

<h1 id="1-docker架构和底层技术简介">1.Docker架构和底层技术简介</h1>

<h1 id="2-docker-image概述">2.Docker Image概述</h1>

<pre><code># 查看现有的Image
sudo docker image ls
# 拉取镜像，如centos镜像
sudo docker pull centos
</code></pre>

<p>Image的获取方法:</p>

<ol>
<li>Build from dockerfile<br /></li>
<li>pull from registry (<a href="https://hub.docker.com/explore/，或者是其他私有仓库">https://hub.docker.com/explore/，或者是其他私有仓库</a>)</li>
</ol>

<h1 id="3-diy一个base-image">3.DIY一个Base Image</h1>

<h2 id="3-1优化输入docker命令的时候不用加sudo">3.1优化输入docker命令的时候不用加sudo</h2>

<ol>
<li><code>sudo groupadd docker</code>，创建docker用户组，不过这个组一般安装好docker之后就会有了</li>
<li><code>sudo gpasswd -a vagrant docker</code>，把vagrant这个用户加入到docker用户组</li>
<li>有的时候会需要重新打开terminal才可以</li>
</ol>

<h1 id="3-2通过dockerfile简单构建镜像">3.2通过Dockerfile简单构建镜像</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> scratch</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># 把hello这个可执行文件拷贝到/路径下</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span><span style="color:#e6db74"> hello /</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># 运行hello</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span><span style="color:#e6db74"> [&#34;/hello&#34;]</span></code></pre></div>
<p><code>docker build -t liguoqinjim/hello-world .</code>，构建镜像的命令，&rdquo;.&ldquo;表示在当前目录里面找Dockerfile，-t指定了镜像的名称</p>

<h1 id="4-初识container">4.初识Container</h1>

<p><img src="https://liguoqinjim.cn/images/docker/note2/什么是Container.png" alt="什么是Container" /></p>

<h2 id="4-1容器相关命令">4.1容器相关命令：</h2>

<ul>
<li><code>docker container ls</code>，列出现在正在运行的容器</li>
<li><code>docker container ls -a</code>，列出所有的容器，包括没有在运行的</li>
<li><code>docker ps -a</code>，列出所有的容器，包括没有在运行的</li>
<li><code>docker run -it centos</code>，交互式运行容器的方法，这样的话运行之后contianer不会退出，但是这个对话关闭这个，contianer还是就会退出了</li>
<li><code>docker container rm container_id</code>，可以删除一个容器（注意，这里的id可以是完整的容器id，也可以是缩写，只要是可以和别的id区分开的就可以了）</li>
<li><code>docker rm container_id</code>，默认就是去删除container的，所以是和docker container rm id是一样的</li>
<li><code>docker images</code>，和docker image ls是一样的，显示本机的所有镜像</li>
<li><code>docker image rm image_id</code>，删除image，可以是image_id或者image_name</li>
<li><code>docker rmi id</code>，是和docker image rm id一样的，是简写</li>
<li><code>docker container ls -aq</code>，只会显示出容器的id，在批量删除容器的时候有用</li>
<li><code>docker rm $(docker container ls -aq)</code>，删除所有的容器</li>
<li><code>docker rm $(docker ps -aq)</code>，也是删除所有的容器</li>
<li><code>docker rm $(docker container ls -f &quot;status=exited&quot; -q)</code>，删除所有不在运行的容器</li>
</ul>

<h2 id="4-2docker镜像拉取加速">4.2docker镜像拉取加速：</h2>

<ul>
<li><a href="https://www.daocloud.io/mirror#accelerator-doc">https://www.daocloud.io/mirror#accelerator-doc</a></li>
<li><a href="https://dev.aliyun.com/search.html">https://dev.aliyun.com/search.html</a></li>
</ul>

<h1 id="5-构建自己的docker镜像">5.构建自己的Docker镜像</h1>

<p>有两种方法可以构建镜像，一种是通过容器创建，我们创建一个容器，比如在里面安装软件，安装完成之后，我们把这个容器commit成镜像。
还有一种是通过Dockerfile来打包镜像。比较推荐Dockerfile的方式，因为使用Dockerfile别人可以清楚看到这个镜像是怎么打包的。
但是要是我们使用commit的方式，别人无法了解我们是怎么生成镜像的，有没有发一些恶意代码等等。</p>

<h2 id="5-1docker-commit的方式创建镜像">5.1docker commit的方式创建镜像</h2>

<p><code>docker commit docker_name liguoqinjim/centos_vim</code><br />
这个命令就是把docker_name这个容器，生成一个镜像，镜像的名称是liguoqinjim/centos_vim</p>

<h2 id="5-2使用dockerfile创建镜像">5.2使用Dockerfile创建镜像</h2>

<p><code>docker build -t liguoqinjim/centos_vim_new .</code><br />
&rdquo;.&ldquo;表示使用当前目录的Dockerfile来创建镜像，liguoqinjim/centos_vim_new就是镜像的名字</p>

<h2 id="notice">NOTICE</h2>

<p>在docker中镜像是只读的，也就是不能写的。那么docker是怎么实现在镜像里面安装好vim的呢？<br />
这是因为docker会自动启动一个container，然后在container里面安装vim，然后再通过这个container来制作成镜像。</p>

<h1 id="6-dockerfile语法梳理及最佳实践">6.Dockerfile语法梳理及最佳实践</h1>

<p>Dockerfile命令：</p>

<h2 id="6-1from">6.1FROM</h2>

<p>尽量使用官方镜像作为base image</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">FROM scratch <span style="color:#75715e">#制作base image，不依靠别的镜像</span>
FROM centos <span style="color:#75715e">#使用base image</span>
FROM ubuntu:14.04 <span style="color:#75715e">#使用base image</span></code></pre></div>
<h2 id="6-2label">6.2LABEL</h2>

<p>设置Metadata</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">LABEL maintainer<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;xiaoquwl@gmail.com&#34;</span>
LABEL version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span>
LABEL description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;This is description&#34;</span></code></pre></div>
<h2 id="6-3run">6.3RUN</h2>

<p>run命令为了美观，最好使用反斜杠换行。<br />
每运行一次run，image都会生成新的一层，所以尽量合并多条命令成为一行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 使用反斜杠换行</span>
RUN yum update <span style="color:#f92672">&amp;&amp;</span> yum install -y vim <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    python-dev   
<span style="color:#75715e"># 主要清理cache</span>
RUN apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install -y perl <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    pwgen --no-install-recommends <span style="color:#f92672">&amp;&amp;</span> rm -rf <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    /var/lib/apt/lists/*</code></pre></div>
<h2 id="6-4workdir">6.4WORKDIR</h2>

<p>能用WORKDIR的就用WORKDIR，不要用RUN去运行cd命令。<br />
WORKDIR后面跟的路径也可以尽量使用绝对路径</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 切换到/root路径</span>
WORKDIR /root
<span style="color:#75715e"># 如果没有会自动创建test文件夹</span>
WORKDIR /test 
WORKDIR demo
<span style="color:#75715e"># 输出结果是/test/demo</span>
RUN pwd</code></pre></div>
<h2 id="6-5add-and-copy">6.5ADD and COPY</h2>

<p>大部分情况下COPY是要优于ADD的，但是ADD有一个解压缩的功能。<br />
要是想添加远程文件的话，可以用RUN命令来运行curl或者wget</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 把hello这个可执行文件添加到/路径下</span>
ADD hello /
<span style="color:#75715e"># 添加到根目录下并且解压test.tar.gz</span>
ADD test.tar.gz /
<span style="color:#75715e"># 文件应该是在/root/test/hello</span>
WORKDIR /root
ADD hello test/
<span style="color:#75715e"># copy版本</span>
WORKDIR /root
COPY hello test/</code></pre></div>
<h2 id="6-6env">6.6ENV</h2>

<p>使用ENV可以增加可维护性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 设置ENV</span>
ENV MYSQL_VERSION <span style="color:#ae81ff">5</span>.6
<span style="color:#75715e"># 使用ENV</span>
RUN apt-get install -y mysql-server<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>MYSQL_VERSION<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*</code></pre></div>
<h2 id="notice-1">NOTICE</h2>

<p>可以参考官方给出的一些例子，和一些官方镜像的Dockerfile<br />
链接：</p>

<ul>
<li><a href="https://github.com/docker-library">https://github.com/docker-library</a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#usage">https://docs.docker.com/engine/reference/builder/#usage</a></li>
</ul>

<h1 id="7-run-vs-cmd-vs-entrypoint">7.RUN vs CMD vs ENTRYPOINT</h1>

<p><code>RUN</code>:执行命令并创建新的Image Layer<br />
<code>CMD</code>:设置容器启动后默认执行的命令和参数<br />
<code>ENTRYPOINT</code>:设置容器启动时运行的命令<br />
这三个命令里面，CMD和ENTRYPOINT是一组的，RUN和他们两个是不一样的</p>

<h2 id="7-1shell和exec格式的区别">7.1Shell和Exec格式的区别</h2>

<h3 id="shell格式">Shell格式</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">RUN apt-get install -y vim
CMD echo <span style="color:#e6db74">&#34;hello docker&#34;</span>
ENTRYPOINT echo <span style="color:#e6db74">&#34;hello docker&#34;</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">FROM centos
ENV name Docker
ENTRYPOINT echo <span style="color:#e6db74">&#34;hello </span>$name<span style="color:#e6db74">&#34;</span></code></pre></div>
<p>###Exec格式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">RUN <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;apt-get&#34;</span>,<span style="color:#e6db74">&#34;install&#34;</span>,<span style="color:#e6db74">&#34;-y&#34;</span>,<span style="color:#e6db74">&#34;vim&#34;</span><span style="color:#f92672">]</span>
CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/bin/echo&#34;</span>,<span style="color:#e6db74">&#34;hello docker&#34;</span><span style="color:#f92672">]</span>
ENTRYPOINT <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;bin/echo&#34;</span>,<span style="color:#e6db74">&#34;hello docker&#34;</span><span style="color:#f92672">]</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">FROM centos
ENV name Docker
ENTRYPOINT <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;bin/echo&#34;</span>,<span style="color:#e6db74">&#34;hello </span>$name<span style="color:#e6db74">&#34;</span><span style="color:#f92672">]</span></code></pre></div>
<h3 id="notice-2">NOTICE</h3>

<p>SHELL格式的时候，<code>echo &quot;hello $name&quot;</code>是会把$name替换掉的，<br />
但是在Exec的格式中，直接使用<code>ENTRYPOINT [&quot;/bin/echo&quot;,&quot;hello $name&quot;]</code>是不会把$name替换掉的，因为这样不是在shell中运行，只是调用了echo命令
想要替换掉$name，需要用<code>ENTRYPOTIN [&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;echo hello $name&quot;]</code></p>

<h2 id="7-2cmd和entrypoint的区别">7.2CMD和ENTRYPOINT的区别</h2>

<h3 id="cmd">CMD</h3>

<p><img src="https://liguoqinjim.cn/images/docker/note2/CMD.png" alt="CMD" /></p>

<h3 id="entrypoint">ENTRYPOINT</h3>

<p><img src="https://liguoqinjim.cn/images/docker/note2/ENTRYPOINT.png" alt="ENTRYPOINT" /></p>

<h3 id="notice-3">NOTICE</h3>

<ul>
<li>CMD是可能会被忽略的，但是ENTRYPOINT不会</li>
<li>如果定义多个CMD，只有最后一个会被执行</li>
</ul>

<h1 id="8-镜像的发布">8.镜像的发布</h1>

<p>镜像的发布一共有三种方式：</p>

<ol>
<li>docker push到hub docker</li>
<li>docker hub和github相连接，我们在github里面写好dockerfile，docker hub会自动打成镜像</li>
<li>自建docker registry</li>
</ol>

<h2 id="8-1docker-push">8.1docker push</h2>

<pre><code>#登录docker hub的账号
docker login
#push镜像，注意镜像名称的开头需要和docker hub的账号是一样的
docker push liguoqinjim/hello-world
</code></pre>

<h2 id="8-2docker-hub和github相连接">8.2docker hub和github相连接</h2>

<p><img src="https://liguoqinjim.cn/images/docker/note2/DockerHub.png" alt="Dockerhub" /></p>

<h2 id="8-3自建docker-registry">8.3自建docker registry</h2>

<ol>
<li>启动docker registry，<code>docker run -d -p 5000:5000 --restart always --name registry registry:2</code></li>
<li>修改/etc/docker/daemon.json<br />
在deamon.json里面添加，&rdquo;insecure-registries:[&ldquo;10.75.44.222:5000&rdquo;]&ldquo;，10.75.44.222就是本机的ip</li>
<li>重启docker</li>
<li><code>docker push localhost:5000/hello-world</code>，推送镜像到docker registry，注意image的开头一定要是docker registry的地址</li>
<li>可以通过api查看是否push成功，<code>curl localhost:5000/v2/_catalog</code>，这个是docker registry提供的api</li>
</ol>

<h1 id="9-dockerfile实战">9.Dockerfile实战</h1>

<p>怎么把一个写好的服务放进docker里面：</p>

<ol>
<li>先FROM编程语言的官方库</li>
<li>RUN命令安装需要的依赖，如(pip install等)</li>
<li>把程序放进通过ADD或者COPY放到镜像里面</li>
<li>EXPOSE 端口，把服务的端口暴露</li>
<li>CMD里面运行程序即可</li>
<li><code>docker run -d image_name</code>，这样我们就运行了这个镜像，且是在后台运行</li>
</ol>

<h2 id="notice-4">NOTICE</h2>

<p>在创建镜像的时候要是出错的话，因为docker在创建镜像的时候，每一步都会创建一个中间镜像。要调试的时候，我们可以run这些中间镜像去调试，比如docker run -it 中间镜像id /bin/bash，就可以进入启动一个这个镜像的容器，然后进入内部查看有什么错误</p>

<h1 id="10-容器的操作">10.容器的操作</h1>

<p>关于容器的几个命令：</p>

<ul>
<li><code>docker run -d --name=demo liguoqinjim/flask-hello-world</code>，运行一个容器，&ndash;name可以指定容器的名称，不然docker会指定一个随机的名称</li>
<li><code>docker exec -it container_id /bin/bash</code>，exec可以让容器执行一个命令，在这个命令里面我们用交互式的方式执行/bin/bash，执行完之后我们就会进入容器内部。当然也是可以执行其他的命令的</li>
<li><code>docker exec -it container_id ip a</code>，运行ip a命令</li>
<li><code>docker stop container_id</code>，停止一个容器</li>
<li><code>docker start container_id</code>，启动一个容器</li>
<li><code>docker inspect container_id</code>，查看一个容器的详细参数</li>
<li><code>docker logs container_id</code>，会打印出容器里面的输出</li>
</ul>

<h1 id="11-dockerfile实战-2">11.Dockerfile实战(2)</h1>

<p>docker的容器大致可以分类两类，一种是app或者服务，就是一直运行在后台的程序。还有一种就是工具类的，运行一次出个结果。</p>

<p>这里引入一个linux下的工具软件，stress，是一个linux系统下测试系统性能的工具。<br />
安装：<code>apt-get update &amp;&amp; apt-get install -y stress</code><br />
使用：<code>stress --vm 1 --verbose</code></p>

<p>使用ENTRYPOINT和CMD配合来获得运行容器时候输入的参数，ENTRYPOINT是要运行的命令，CMD获取运行容器时候输入的命令<br />
如：<code>docker run -it liguoqinjim/ubuntu-stress --vm 1</code>，这样<code>--vm 1</code>就传给了<code>/usr/bin/stress</code>并运行</p>

<pre><code>FROM ubuntu
RUN apt-get update &amp;&amp; apt-get install -y stress
ENTRYPOINT [&quot;/usr/bin/stress&quot;]
CMD []
</code></pre>

<h1 id="12-容器的资源限制">12.容器的资源限制</h1>

<p>可以在容器运行的时候加上参数对容器的资源进行限制。</p>

<h2 id="12-1限制内存">12.1限制内存</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker run --memory<span style="color:#f92672">=</span>300M liguoqinjim/ubuntu-stress --vm <span style="color:#ae81ff">1</span> --verbose</code></pre></div>
<p>&ndash;memory设置了300M内存，但是要是没有设置&ndash;memory-swap的话，他的默认值就和&ndash;memory一样。那么在&ndash;memory设为200的时候，机器的内存就可以认为是200的memory加上200的memory-swap，也就是400M的内存，在上面这个命令中就是600M内存</p>

<h2 id="12-2限制cpu">12.2限制cpu</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker run --cpu-shares<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> --name<span style="color:#f92672">=</span>test1 liguoqinjim/ubuntu-stress --cpu <span style="color:#ae81ff">1</span>
docker run --cpu-shares<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> --name<span style="color:#f92672">=</span>test2 liguoqinjim/ubuntu-stress --cpu <span style="color:#ae81ff">1</span></code></pre></div>
<p>&ndash;cpu-shares是docker的参数，&ndash;cpu是给stress的参数。&ndash;cpu-shares就是当有多个设置了&ndash;cpu-shares的时候，他们分配的到的cpu就是他们的权重。比如上面的情况就是test1可以使用大约66%的cpu，而test2可以使用33%</p>
    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://liguoqinjim.cn/tags/docker/">docker</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%89/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">系统学习Docker 践行DevOps理念 笔记(三)|Docker的网络</span>
            <span class="prev-text nav-mobile"></span>
          </a>
        
          <a class="next" href="https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%B8%80/">
            <span class="next-text nav-default">系统学习Docker 践行DevOps理念 笔记(一)|Docker的安装</span>
            <span class="prev-text nav-mobile"></span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://liguoqinjim.cn/post/docker/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0docker-%E8%B7%B5%E8%A1%8Cdevops%E7%90%86%E5%BF%B5-%E7%AC%94%E8%AE%B0%E4%BA%8C/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'liguoqinjim';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  


<a href="https://liguoqinjim.cn/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
       -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        © This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License，please give source if you wish to quote or reproduce.
        
      </span></span>

  
  

  
    <span>
      <a href='http://www.beian.miit.gov.cn'>沪ICP备19042199号-1</a>
    </span>
  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="https://liguoqinjim.cn/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="https://liguoqinjim.cn/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="https://liguoqinjim.cn/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>


























</body>
</html>
